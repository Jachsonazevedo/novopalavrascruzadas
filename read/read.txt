<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Schola da Mente - Palavras Cruzadas</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --schola-blue: #1e3a8a;
            --schola-gold: #fbbf24;
            --schola-bg: #f8fafc;
            --cell-size: clamp(34px, 5vw, 52px); /* Células ajustadas para balancear com a lista lateral */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--schola-bg);
            color: #334155;
            height: 100vh;
            /* Permite rolagem da página inteira se necessário, mas tenta evitar */
            overflow-y: auto; 
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            user-select: none;
        }

        .btn-action { transition: transform 0.1s; }
        .btn-action:active { transform: translateY(2px); }

        /* --- LAYOUT PRINCIPAL --- */
        .game-content {
            flex: 1;
            display: flex;
            flex-direction: column; /* Mobile: Coluna (Grade em cima, Lista embaixo) */
            align-items: center;
            width: 100%;
            padding: 20px 10px 100px 10px; /* Padding bottom para footer */
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 1024px) {
            .game-content {
                flex-direction: row; /* Desktop: Lado a Lado */
                align-items: flex-start; /* Alinha no topo */
                justify-content: center;
                gap: 40px;
                padding: 40px;
                height: calc(100vh - 80px); /* Tenta caber na tela sem scroll da página */
                overflow: hidden; /* No desktop, tentamos conter tudo */
            }
        }

        /* --- SEÇÃO DA GRADE (ESQUERDA NO DESKTOP) --- */
        .grid-section {
            display: flex;
            justify-content: center;
            flex-shrink: 0;
            margin-bottom: 20px;
            flex: 2; /* Ocupa mais espaço que a lista */
        }

        @media (min-width: 1024px) {
            .grid-section {
                margin-bottom: 0;
                justify-content: flex-end; /* Encosta na lista */
            }
        }

        .crossword-wrapper {
            background-color: #eef2ff; 
            padding: 15px;
            border-radius: 12px;
            border: 4px solid #1e3a8a;
            /* Sombra suave para destacar do fundo */
            box-shadow: 0 10px 30px -5px rgba(30, 58, 138, 0.2);
            max-width: 100%;
            overflow: auto; 
            display: inline-block;
        }

        .crossword-grid {
            display: grid;
            gap: 3px; 
            background-color: transparent;
            border: none;
            margin: 0 auto;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
        }

        /* Quadrado Vazio */
        .cell.block { background-color: transparent; cursor: default; pointer-events: none; }
        .cell.block::after {
            content: ''; width: 4px; height: 4px; background-color: #cbd5e1; border-radius: 50%; display: block; opacity: 0.4;
        }

        /* Quadrado Letra */
        .cell.active {
            background-color: #fff;
            border: 2px solid #94a3b8;
            border-radius: 6px; 
            cursor: pointer;
            box-shadow: 0 3px 0 #94a3b8; 
            transition: transform 0.1s, background-color 0.2s;
            z-index: 1;
        }
        .cell.active:active { transform: translateY(2px); box-shadow: 0 1px 0 #94a3b8; }

        .cell-number {
            position: absolute; top: 1px; left: 3px; font-size: calc(var(--cell-size) * 0.25); line-height: 1; color: #64748b; font-weight: 700; pointer-events: none;
        }
        .cell-letter {
            font-size: calc(var(--cell-size) * 0.65); font-weight: 800; color: #1e3a8a; line-height: 1; margin-top: 4px;
        }

        .cell.highlighted-word { background-color: #eff6ff; border-color: #60a5fa; box-shadow: 0 3px 0 #60a5fa; }
        .cell.selected { background-color: #fffbeb !important; border-color: #fbbf24 !important; box-shadow: 0 3px 0 #d97706 !important; transform: translateY(-2px); z-index: 10; }
        .cell.correct { background-color: #f0fdf4 !important; border-color: #22c55e !important; box-shadow: 0 3px 0 #15803d !important; color: #15803d; }
        .cell.wrong { background-color: #fef2f2 !important; border-color: #ef4444 !important; box-shadow: 0 3px 0 #b91c1c !important; animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px); } 75% { transform: translateX(4px); } }

        /* --- LISTA DE PERGUNTAS (DIREITA E ESTÁTICA) --- */
        .clues-section {
            width: 100%;
            max-width: 500px;
            
            /* Visual Limpo sem Scrollbar Interna */
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            
            /* Importante: Altura automática para mostrar tudo */
            height: auto; 
            flex-shrink: 0;
        }

        @media (min-width: 1024px) {
            .clues-section {
                width: 320px; /* Largura fixa na lateral */
                max-width: 320px;
                /* No desktop, se a lista for muito longa, permitimos scroll APENAS se ultrapassar a tela, mas a ideia é caber */
                max-height: 90%; 
                overflow-y: auto; 
            }
        }

        .clue-group {
            margin-bottom: 20px;
        }
        .clue-group:last-child { margin-bottom: 0; }

        .clue-group-title {
            font-size: 0.95rem;
            text-transform: uppercase;
            color: #1e3a8a;
            font-weight: 800;
            margin-bottom: 12px;
            border-bottom: 2px solid #fbbf24;
            display: inline-block;
            padding-bottom: 4px;
            letter-spacing: 0.05em;
        }

        .clues-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 10px; /* Espaço confortável entre itens */
        }

        .clue-item {
            font-size: 0.95rem;
            color: #475569;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 6px;
            transition: all 0.2s;
            line-height: 1.4;
            display: flex;
            align-items: flex-start;
            border-left: 3px solid transparent; /* Indicador */
        }

        .clue-item:hover { background-color: #f8fafc; border-left-color: #cbd5e1; }
        
        .clue-item.active-clue {
            background-color: #eff6ff;
            color: #1e3a8a;
            font-weight: 600;
            border-left-color: #1e3a8a;
        }

        .clue-item.solved-clue {
            text-decoration: line-through;
            color: #166534; /* Verde sucesso */
            background-color: #f0fdf4;
            border-left-color: #22c55e;
            opacity: 0.7;
        }

        .clue-number {
            font-weight: 800;
            color: #1e3a8a;
            margin-right: 10px;
            min-width: 20px;
        }
        .solved-clue .clue-number { color: #166534; }

        /* --- RODAPÉ FIXO --- */
        .fixed-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #cbd5e1; z-index: 50;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08); padding-bottom: env(safe-area-inset-bottom);
        }

        #hidden-input { position: absolute; opacity: 0; top: -1000px; }

        /* Ajustes Mobile */
        @media (max-width: 1023px) {
            .clues-section {
                order: 2; /* No mobile, fica abaixo da grade */
                margin-top: 20px;
            }
            .grid-section {
                order: 1;
            }
            .game-content {
                padding-bottom: 120px; /* Mais espaço para footer */
                overflow-y: auto; /* Permite scroll na página pois a lista é comprida */
            }
        }
    </style>
</head>
<body>

    <input type="text" id="hidden-input" autocomplete="off" autocorrect="off" autocapitalize="characters">

    <!-- LOGIN -->
    <div id="screen-login" class="absolute inset-0 z-50 bg-white flex flex-col items-center justify-center p-4 text-center">
        <div class="mb-8">
            <div class="inline-block p-6 rounded-full bg-blue-50 mb-4 animate-bounce">
                <i class="fas fa-brain text-7xl text-blue-800"></i>
            </div>
            <h1 class="text-4xl font-extrabold text-blue-900 tracking-tight">Schola da Mente</h1>
            <p class="text-xl text-yellow-600 font-bold mt-2 uppercase">Palavras Cruzadas</p>
        </div>
        <div class="w-full max-w-sm">
            <label class="block text-gray-500 font-bold mb-2 text-sm uppercase tracking-wider">Digite seu nome</label>
            <input type="text" id="username-input" class="w-full p-4 text-2xl text-center border-2 border-gray-200 rounded-2xl focus:border-blue-500 outline-none mb-6 uppercase text-blue-900 font-bold" placeholder="SEU NOME" maxlength="12">
            <button onclick="goToSettings()" class="w-full bg-blue-800 hover:bg-blue-700 text-white text-xl font-bold py-4 rounded-2xl shadow-lg btn-action transition-all">COMEÇAR</button>
        </div>
    </div>

    <!-- SETTINGS -->
    <div id="screen-settings" class="hidden absolute inset-0 z-40 bg-slate-50 flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-md text-center bg-white p-8 rounded-3xl shadow-xl border border-slate-100">
            <h2 class="text-3xl font-bold text-slate-800 mb-8">Olá, <span id="display-name" class="text-blue-600"></span>!</h2>
            <div class="mb-8 text-left">
                <p class="text-slate-400 font-bold mb-3 text-xs uppercase tracking-wider">Nível</p>
                <div class="flex gap-3">
                    <button onclick="selectDifficulty('easy')" id="btn-easy" class="flex-1 py-4 border-2 border-green-400 text-green-600 font-bold rounded-xl hover:bg-green-50 transition-all">FÁCIL</button>
                    <button onclick="selectDifficulty('medium')" id="btn-medium" class="flex-1 py-4 border-2 border-yellow-400 text-yellow-600 font-bold rounded-xl hover:bg-yellow-50 transition-all">MÉDIO</button>
                    <button onclick="selectDifficulty('hard')" id="btn-hard" class="flex-1 py-4 border-2 border-red-400 text-red-600 font-bold rounded-xl hover:bg-red-50 transition-all">DIFÍCIL</button>
                </div>
            </div>
            <div class="mb-8 text-left">
                <p class="text-slate-400 font-bold mb-3 text-xs uppercase tracking-wider">Tema</p>
                <select id="theme-select" class="w-full p-4 text-lg border-2 border-slate-200 rounded-xl text-slate-700 bg-white font-bold outline-none focus:border-blue-500 cursor-pointer"></select>
            </div>
            <button onclick="startGame()" class="w-full bg-yellow-500 text-white text-xl font-bold py-5 rounded-2xl shadow-lg btn-action hover:bg-yellow-400">JOGAR AGORA</button>
        </div>
    </div>

    <!-- GAME -->
    <div id="screen-game" class="hidden flex flex-col h-full bg-slate-50 relative z-30">
        
        <!-- Header -->
        <header class="bg-white text-slate-800 p-3 shadow-sm flex flex-col items-center justify-center shrink-0 z-20 border-b border-slate-200">
            <h1 id="game-theme-display" class="text-lg md:text-2xl font-extrabold text-blue-900 uppercase tracking-wider text-center"></h1>
            <div class="w-full flex justify-between items-center px-4 max-w-6xl mt-1">
                <div class="text-slate-500 font-semibold text-xs flex items-center">
                    <div class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center mr-2 text-blue-600"><i class="fas fa-user"></i></div>
                    <span id="game-player-display">Jogador</span>
                </div>
                <div class="flex items-center bg-yellow-100 px-3 py-1 rounded-full border border-yellow-200">
                    <i class="fas fa-coins text-yellow-600 mr-2 text-sm"></i>
                    <span id="coin-balance" class="font-bold text-yellow-700 text-md">0</span>
                </div>
            </div>
        </header>

        <!-- Conteúdo Principal -->
        <div class="game-content" onclick="focusInput()">
            
            <!-- Grade do Jogo (ESQUERDA NO DESKTOP) -->
            <div class="grid-section">
                <div id="grid-wrapper" class="crossword-wrapper"></div>
            </div>

            <!-- LISTA DE PERGUNTAS (DIREITA NO DESKTOP) -->
            <div class="clues-section">
                <!-- Horizontais -->
                <div class="clue-group">
                    <div class="clue-group-title"><i class="fas fa-arrow-right mr-1"></i> Horizontais</div>
                    <div id="clues-horizontal-list" class="clues-list"></div>
                </div>
                <!-- Verticais -->
                <div class="clue-group">
                    <div class="clue-group-title"><i class="fas fa-arrow-down mr-1"></i> Verticais</div>
                    <div id="clues-vertical-list" class="clues-list"></div>
                </div>
            </div>

        </div>

        <!-- Feedback Visual -->
        <div id="feedback-message" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 hidden z-50 pointer-events-none w-10/12 max-w-sm"></div>

        <!-- Footer Controles -->
        <footer class="fixed-footer">
            <div class="bg-blue-50 border-b border-blue-100 p-2 text-center">
                <p id="footer-current-clue" class="text-sm text-blue-900 font-bold leading-tight line-clamp-1">Toque numa palavra para jogar</p>
            </div>
            <div class="p-3 flex gap-3 justify-center bg-white max-w-xl mx-auto items-center">
                <button onclick="resetGame()" class="flex-1 py-3 bg-slate-100 rounded-xl text-slate-600 font-bold text-xs shadow-sm active:bg-slate-200 transition"><i class="fas fa-redo text-lg block mb-1"></i> REINICIAR</button>
                <button onclick="useHint()" class="flex-grow-[2] py-3 bg-yellow-400 rounded-xl text-white font-bold text-sm shadow-md active:bg-yellow-500 btn-action border-b-4 border-yellow-500 active:border-b-0 active:mt-1"><i class="fas fa-lightbulb text-lg mb-1 inline-block mr-1"></i> DICA <span class="text-xs font-normal opacity-90">(2)</span></button>
                <button onclick="goToSettings()" class="flex-1 py-3 bg-blue-50 rounded-xl text-blue-600 font-bold text-xs shadow-sm active:bg-blue-100 transition"><i class="fas fa-bars text-lg block mb-1"></i> MENU</button>
            </div>
        </footer>
    </div>

    <!-- Vitória -->
    <div id="modal-victory" class="hidden fixed inset-0 z-[60] bg-black bg-opacity-80 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl border-4 border-yellow-400 animate-bounce">
            <div class="inline-block p-6 rounded-full bg-yellow-50 mb-6"><i class="fas fa-trophy text-6xl text-yellow-500"></i></div>
            <h2 class="text-4xl font-extrabold text-slate-800 mb-2">PARABÉNS!</h2>
            <p class="text-lg text-slate-500 mb-6 font-medium">Você completou o desafio!</p>
            <div class="bg-blue-50 p-4 rounded-xl mb-8 border border-blue-100">
                <p class="text-xs font-bold text-blue-400 uppercase">Recompensa</p>
                <p class="text-3xl font-extrabold text-yellow-500">+100 MOEDAS</p>
            </div>
            <div class="flex flex-col gap-3">
                <button onclick="resetGame()" class="w-full bg-blue-600 text-white text-lg font-bold py-4 rounded-2xl shadow-xl hover:bg-blue-700 btn-action transition transform active:scale-95">JOGAR NOVAMENTE</button>
                <button onclick="goToSettings()" class="w-full bg-white text-slate-600 text-lg font-bold py-4 rounded-2xl shadow-sm border-2 border-slate-200 hover:bg-slate-50">VOLTAR AO MENU</button>
            </div>
        </div>
    </div>

    <script>
        const THEMES = {
            "CASA": [{word:"SALA",clue:"Recebemos visitas aqui"},{word:"CAMA",clue:"Móvel para dormir"},{word:"MESA",clue:"Usada para refeições"},{word:"TETO",clue:"Cobre a casa"},{word:"PISO",clue:"Revestimento do chão"},{word:"SOFA",clue:"Assento estofado"},{word:"PIA",clue:"Lavar louça ou mãos"}],
            "CORPO": [{word:"BOCA",clue:"Falar e comer"},{word:"PELE",clue:"Maior órgão do corpo"},{word:"UNHA",clue:"Ponta dos dedos"},{word:"DEDO",clue:"Temos 5 na mão"},{word:"NARIZ",clue:"Sentir cheiro"},{word:"OLHO",clue:"Órgão da visão"},{word:"PE",clue:"Usado para andar"}],
            "ALIMENTOS": [{word:"PAO",clue:"Massa de farinha assada"},{word:"UVA",clue:"Fruta do vinho"},{word:"OVO",clue:"Vem da galinha"},{word:"SAL",clue:"Tempero salgado"},{word:"MEL",clue:"Feito por abelhas"},{word:"BOLO",clue:"Doce de festa"},{word:"ARROZ",clue:"Dupla do feijão"}],
            "BRASIL": [{word:"SAMBA",clue:"Ritmo do carnaval"},{word:"REAL",clue:"Moeda nacional"},{word:"PRAIA",clue:"Mar e areia"},{word:"VERDE",clue:"Cor das matas"},{word:"CAFE",clue:"Bebida nacional"},{word:"SOL",clue:"País tropical"}],
            "PAISES": [{word:"CHINA",clue:"País da muralha"},{word:"JAPAO",clue:"Sol nascente"},{word:"CHILE",clue:"Vizinho andino"},{word:"PERU",clue:"Machu Picchu fica lá"},{word:"INDIA",clue:"País do Taj Mahal"},{word:"USA",clue:"Sigla Estados Unidos"}],
            "ESTADOS": [{word:"BAHIA",clue:"Terra do axé"},{word:"PARA",clue:"Terra do açaí"},{word:"GOIAS",clue:"Centro do Brasil"},{word:"CEARA",clue:"Terra do humor"},{word:"ACRE",clue:"Região Norte"},{word:"RIO",clue:"Cristo Redentor"},{word:"MINAS",clue:"Pão de queijo"}],
            "ANIMAIS": [{word:"ZEBRA",clue:"Listrada preto e branco"},{word:"URSO",clue:"Gosta de mel"},{word:"TIGRE",clue:"Felino listrado"},{word:"GATO",clue:"Mia no telhado"},{word:"LOBO",clue:"Parece cão selvagem"},{word:"FOCA",clue:"Bate palmas"},{word:"PATO",clue:"Nada na lagoa"}],
            "FRUTAS": [{word:"MACA",clue:"Branca de Neve comeu"},{word:"PERA",clue:"Formato de gota"},{word:"UVA",clue:"Cachos roxos"},{word:"LIMAO",clue:"Azedo e verde"},{word:"MANGA",clue:"Amarela com caroço"},{word:"COCO",clue:"Tem água dentro"},{word:"FIGO",clue:"Fruta doce em compota"}],
            "ESCOLA": [{word:"LIVRO",clue:"Para ler"},{word:"LAPIS",clue:"Para escrever"},{word:"GIZ",clue:"Para o quadro negro"},{word:"AULA",clue:"Hora de aprender"},{word:"PROVA",clue:"Teste escolar"},{word:"ALUNO",clue:"Estudante"},{word:"SALA",clue:"Local da turma"}],
            "CORES": [{word:"AZUL",clue:"Cor do céu"},{word:"ROSA",clue:"Cor de flor"},{word:"VERDE",clue:"Cor da grama"},{word:"PRETO",clue:"Cor escura"},{word:"ROXO",clue:"Azul com vermelho"},{word:"CINZA",clue:"Dia nublado"},{word:"BEGE",clue:"Tom de areia"}],
            "ROUPAS": [{word:"MEIA",clue:"No pé"},{word:"SAIA",clue:"Feminina"},{word:"BONE",clue:"Na cabeça"},{word:"LUVA",clue:"Na mão"},{word:"CINTO",clue:"Na cintura"},{word:"GOLA",clue:"No pescoço"}],
            "BEBIDAS": [{word:"AGUA",clue:"H2O"},{word:"SUCO",clue:"De frutas"},{word:"CHA",clue:"Infusão quente"},{word:"VINHO",clue:"De uva"},{word:"LEITE",clue:"Da vaca"}],
            "FAMILIA": [{word:"MAE",clue:"Geradora"},{word:"PAI",clue:"Genitor"},{word:"AVO",clue:"Pai do pai"},{word:"TIO",clue:"Irmão do pai"},{word:"NETO",clue:"Filho do filho"},{word:"IRMA",clue:"Mesmos pais"}],
            "TEMPO": [{word:"VERAO",clue:"Estação quente"},{word:"FRIO",clue:"Inverno"},{word:"CHUVA",clue:"Água do céu"},{word:"NOITE",clue:"Escuro"},{word:"DIA",clue:"Claro"},{word:"HORA",clue:"60 minutos"},{word:"ANO",clue:"365 dias"}],
            "OBJETOS": [{word:"CHAVE",clue:"Abre porta"},{word:"MALA",clue:"Viagem"},{word:"VELA",clue:"Ilumina"},{word:"PENTE",clue:"Cabelo"},{word:"REDE",clue:"Descanso"},{word:"ANEL",clue:"Dedo"}],
            "PROFISSOES": [{word:"MEDICO",clue:"Cuida da saúde"},{word:"ATOR",clue:"Trabalha em novelas"},{word:"JUIZ",clue:"Trabalha no tribunal"},{word:"PADEIRO",clue:"Faz pão"},{word:"PINTOR",clue:"Pinta casas"},{word:"CANTOR",clue:"Usa a voz"}],
            "ESPORTES": [{word:"VOLEI",clue:"Jogado com as mãos"},{word:"TENIS",clue:"Usa raquete"},{word:"GOLF",clue:"Acertar bola no buraco"},{word:"BOXE",clue:"Luta com luvas"},{word:"JUDO",clue:"Arte marcial japonesa"},{word:"SURF",clue:"Prancha na onda"}],
            "NATUREZA": [{word:"RIO",clue:"Corre para o mar"},{word:"LAGO",clue:"Água parada"},{word:"SERRA",clue:"Muitas montanhas"},{word:"FLOR",clue:"Parte colorida"},{word:"RAIZ",clue:"Fixa no solo"},{word:"MAR",clue:"Água salgada"}],
            "SENTIMENTOS": [{word:"AMOR",clue:"Grande afeto"},{word:"MEDO",clue:"Susto, pavor"},{word:"RAIVA",clue:"Irritação forte"},{word:"DOR",clue:"Sensação ruim"},{word:"PENA",clue:"Dó, compaixão"},{word:"PAZ",clue:"Tranquilidade"}],
            "COZINHA": [{word:"FACA",clue:"Corta alimentos"},{word:"COPO",clue:"Beber água"},{word:"GARFO",clue:"Para espetar comida"},{word:"FOGAO",clue:"Cozinha a comida"},{word:"FORNO",clue:"Assa bolo"},{word:"BULE",clue:"Serve café"}],
            "TRANSPORTE": [{word:"CARRO",clue:"Tem 4 rodas"},{word:"TREM",clue:"Anda no trilho"},{word:"NAVIO",clue:"Anda no mar"},{word:"MOTO",clue:"Tem 2 rodas"},{word:"TAXI",clue:"Carro de aluguel"},{word:"JIPE",clue:"Carro forte"}],
            "INSTRUMENTOS": [{word:"PIANO",clue:"Teclas pretas e brancas"},{word:"HARPA",clue:"Cordas celestial"},{word:"BOMBO",clue:"Tambor grave"},{word:"GAITA",clue:"Sopro pequeno"},{word:"TUBA",clue:"Sopro grande"},{word:"SINO",clue:"Toca na igreja"}],
            "UNIVERSO": [{word:"LUA",clue:"Satélite da Terra"},{word:"SOL",clue:"Nossa estrela"},{word:"CEU",clue:"Onde ficam as nuvens"},{word:"MARTE",clue:"Planeta vermelho"},{word:"TERRA",clue:"Onde vivemos"},{word:"LUZ",clue:"Viaja rápido"}],
            "HIGIENE": [{word:"SABAO",clue:"Lava e limpa"},{word:"BANHO",clue:"Limpeza do corpo"},{word:"DENTE",clue:"Escovar após comer"},{word:"UNHA",clue:"Cortar e limpar"},{word:"AGUA",clue:"Enxaguar"},{word:"PAPEL",clue:"Secar ou limpar"}],
            "VALORES": [{word:"AMOR",clue:"Carinho"},{word:"FE",clue:"Acreditar"},{word:"PAZ",clue:"Sem guerra"},{word:"HONRA",clue:"Dignidade"},{word:"ETICA",clue:"Fazer o certo"},{word:"BEM",clue:"Oposto de mal"}],
            "FESTAS": [{word:"NATAL",clue:"Nascimento de Jesus"},{word:"VALSA",clue:"Dança de 15 anos"},{word:"BOLO",clue:"Tem no aniversário"},{word:"VELA",clue:"Sopra no parabéns"},{word:"NOIVA",clue:"Casa no altar"}],
            "TECNOLOGIA": [{word:"RADIO",clue:"Ouvimos música"},{word:"TV",clue:"Assistimos novela"},{word:"MOUSE",clue:"Rato do PC"},{word:"FONE",clue:"No ouvido"},{word:"CHIP",clue:"No celular"},{word:"WIFI",clue:"Internet sem fio"}],
            "FLORES": [{word:"ROSA",clue:"Tem espinhos"},{word:"LIRIO",clue:"Símbolo de pureza"},{word:"CRAVO",clue:"Brigou com a rosa"},{word:"LOTUS",clue:"Flor sagrada"},{word:"JASMIM",clue:"Muito perfumada"}],
            "SIGNOS": [{word:"LEAO",clue:"Rei da selva"},{word:"VIRGEM",clue:"Organizado"},{word:"LIBRA",clue:"Balança"},{word:"PEIXES",clue:"Água"},{word:"TOURO",clue:"Terra"},{word:"ARIES",clue:"Fogo"}],
            "MESES": [{word:"ABRIL",clue:"Descobrimento"},{word:"MAIO",clue:"Mês das mães"},{word:"JULHO",clue:"Férias"},{word:"MARCO",clue:"Fim do verão"},{word:"JUNHO",clue:"Festas juninas"}]
        };

        const state = {
            username: localStorage.getItem('schola_user') || '',
            coins: parseInt(localStorage.getItem('schola_coins')) || 10, 
            difficulty: 'easy',
            theme: '',
            gridSize: 8,
            grid: [], 
            wordsOnBoard: [], 
            selectedCell: null,
            selectedWordIndex: -1,
            inputElem: document.getElementById('hidden-input')
        };

        window.onload = () => {
            setupInputListener();
            populateThemes();
            if(state.username) {
                document.getElementById('username-input').value = state.username;
                document.getElementById('screen-login').classList.add('hidden');
                document.getElementById('screen-settings').classList.remove('hidden');
                updateUI();
            }
        };

        function populateThemes() {
            const sel = document.getElementById('theme-select');
            sel.innerHTML = '';
            Object.keys(THEMES).sort().forEach(k => {
                const opt = document.createElement('option');
                opt.value = k;
                opt.innerText = k;
                sel.appendChild(opt);
            });
        }

        function updateUI() {
            document.getElementById('display-name').innerText = state.username;
            document.getElementById('game-player-display').innerText = state.username;
            document.getElementById('coin-balance').innerText = state.coins;
            localStorage.setItem('schola_coins', state.coins);
            ['easy', 'medium', 'hard'].forEach(l => {
                const btn = document.getElementById(`btn-${l}`);
                btn.classList.remove('ring-4', 'ring-blue-300');
                if(l === state.difficulty) btn.classList.add('ring-4', 'ring-blue-300');
            });
        }

        function selectDifficulty(lvl) { state.difficulty = lvl; updateUI(); }

        function goToSettings() {
            const name = document.getElementById('username-input').value.trim();
            if(name) { state.username = name; localStorage.setItem('schola_user', name); }
            else if (!state.username) { alert("Digite seu nome!"); return; }
            document.getElementById('screen-login').classList.add('hidden');
            document.getElementById('screen-game').classList.add('hidden');
            document.getElementById('modal-victory').classList.add('hidden');
            document.getElementById('screen-settings').classList.remove('hidden');
            updateUI();
        }

        function startGame() {
            const theme = document.getElementById('theme-select').value;
            state.theme = theme;
            if(state.difficulty === 'easy') state.gridSize = 9; 
            else if(state.difficulty === 'medium') state.gridSize = 11;
            else state.gridSize = 13;

            if(generateCrossword(theme)) {
                renderGrid();
                renderClueList();
                document.getElementById('screen-settings').classList.add('hidden');
                document.getElementById('screen-game').classList.remove('hidden');
                document.getElementById('game-theme-display').innerText = "TEMA: " + theme;
                state.selectedCell = null;
                state.selectedWordIndex = -1;
                document.getElementById('footer-current-clue').innerText = "Toque em um quadrado ou na lista.";
            } else {
                alert("Tente outro tema!");
            }
        }

        function generateCrossword(themeKey) {
            let bestBoard = null;
            let maxWords = 0;
            for(let attempt = 0; attempt < 100; attempt++) {
                const size = state.gridSize;
                let grid = Array(size).fill(null).map(() => Array(size).fill(null));
                let placedWords = [];
                let wordsToTry = JSON.parse(JSON.stringify(THEMES[themeKey]));
                wordsToTry.sort(() => Math.random() - 0.5);
                const longest = wordsToTry.reduce((a,b) => a.word.length > b.word.length ? a : b);
                wordsToTry = wordsToTry.filter(w => w !== longest);
                wordsToTry.unshift(longest);

                const first = wordsToTry[0];
                const dir = Math.random() > 0.5 ? 'H' : 'V';
                const sx = Math.floor((size - (dir === 'H' ? first.word.length : 1))/2);
                const sy = Math.floor((size - (dir === 'V' ? first.word.length : 1))/2);
                
                if(placeWordIfFits(grid, first, sx, sy, dir, size)) {
                    placedWords.push({...first, x: sx, y: sy, dir: dir, solved: false});
                }

                for(let i=1; i<wordsToTry.length; i++) {
                    const w = wordsToTry[i];
                    const fit = findBestPosition(grid, w.word, placedWords, size);
                    if(fit) {
                        if(placeWordIfFits(grid, w, fit.x, fit.y, fit.dir, size)) {
                            placedWords.push({...w, x: fit.x, y: fit.y, dir: fit.dir, solved: false});
                        }
                    }
                }
                if(placedWords.length > maxWords) {
                    maxWords = placedWords.length;
                    bestBoard = { grid: cloneGrid(grid), placedWords: JSON.parse(JSON.stringify(placedWords)) };
                }
            }
            if(maxWords < 2) return false;

            const finalWords = bestBoard.placedWords;
            const startCells = [];
            finalWords.forEach(w => {
                if(!startCells.some(c => c.x === w.x && c.y === w.y)) startCells.push({x: w.x, y: w.y});
            });
            startCells.sort((a,b) => (a.y - b.y) || (a.x - b.x));
            startCells.forEach((c, index) => {
                const num = index + 1;
                finalWords.filter(w => w.x === c.x && w.y === c.y).forEach(w => w.number = num);
            });

            state.wordsOnBoard = finalWords;
            state.grid = Array(state.gridSize).fill(null).map(() => Array(state.gridSize).fill(null));
            for(let y=0; y<state.gridSize; y++) for(let x=0; x<state.gridSize; x++) state.grid[y][x] = { type: 'block' };

            state.wordsOnBoard.forEach((w, idx) => {
                for(let i=0; i<w.word.length; i++) {
                    let cx = w.dir === 'H' ? w.x + i : w.x;
                    let cy = w.dir === 'H' ? w.y : w.y + i;
                    if(state.grid[cy][cx].type !== 'letter') {
                        state.grid[cy][cx] = { type: 'letter', char: w.word[i], userChar: '', refs: [], displayNumber: null };
                    }
                    state.grid[cy][cx].refs.push(idx);
                    if(i === 0) state.grid[cy][cx].displayNumber = w.number;
                }
            });
            return true;
        }

        function cloneGrid(grid) { return grid.map(row => [...row]); }
        function findBestPosition(grid, wordStr, placed, size) {
            const shuffledPlaced = [...placed].sort(() => Math.random() - 0.5);
            for(let p of shuffledPlaced) {
                const intersections = getIntersections(wordStr, p.word);
                for (let inter of intersections) {
                    const newDir = p.dir === 'H' ? 'V' : 'H';
                    let nx, ny;
                    if(newDir === 'V') { nx = p.x + inter.idxB; ny = p.y - inter.idxA; } 
                    else { nx = p.x - inter.idxA; ny = p.y + inter.idxB; }
                    if(canPlaceStrict(grid, wordStr, nx, ny, newDir, size)) return {x: nx, y: ny, dir: newDir};
                }
            }
            return null;
        }
        function getIntersections(wordA, wordB) {
            let res = [];
            for(let i=0; i<wordA.length; i++) for(let j=0; j<wordB.length; j++) if(wordA[i] === wordB[j]) res.push({idxA: i, idxB: j});
            return res;
        }
        function canPlaceStrict(grid, word, x, y, dir, size) {
            if(x < 0 || y < 0) return false;
            if(dir === 'H' && x + word.length > size) return false;
            if(dir === 'V' && y + word.length > size) return false;
            const beforeX = dir === 'H' ? x - 1 : x;
            const beforeY = dir === 'H' ? y : y - 1;
            const afterX = dir === 'H' ? x + word.length : x;
            const afterY = dir === 'H' ? y : y + word.length;
            if(beforeX >= 0 && beforeY >= 0 && grid[beforeY][beforeX] !== null) return false;
            if(afterX < size && afterY < size && grid[afterY][afterX] !== null) return false;
            for(let i=0; i<word.length; i++) {
                let cx = dir === 'H' ? x + i : x;
                let cy = dir === 'H' ? y : y + i;
                const cell = grid[cy][cx];
                if(cell !== null && cell !== word[i]) return false;
                if(cell === null) {
                    if(dir === 'H') { if((y > 0 && grid[y-1][cx] !== null) || (y < size-1 && grid[y+1][cx] !== null)) return false; }
                    else { if((x > 0 && grid[cy][x-1] !== null) || (x < size-1 && grid[cy][x+1] !== null)) return false; }
                }
            }
            return true;
        }
        function placeWordIfFits(grid, wObj, x, y, dir, size) {
            if(!canPlaceStrict(grid, wObj.word, x, y, dir, size)) return false;
            for(let i=0; i<wObj.word.length; i++) {
                let cx = dir === 'H' ? x + i : x;
                let cy = dir === 'H' ? y : y + i;
                grid[cy][cx] = wObj.word[i];
            }
            return true;
        }

        function renderGrid() {
            const wrapper = document.getElementById('grid-wrapper');
            wrapper.innerHTML = '';
            const gridEl = document.createElement('div');
            gridEl.className = 'crossword-grid';
            gridEl.style.gridTemplateColumns = `repeat(${state.gridSize}, 1fr)`;
            for(let y=0; y<state.gridSize; y++) {
                for(let x=0; x<state.gridSize; x++) {
                    const data = state.grid[y][x];
                    const cell = document.createElement('div');
                    if(data.type === 'block') { cell.className = 'cell block'; } 
                    else {
                        cell.className = 'cell active';
                        cell.dataset.x = x;
                        cell.dataset.y = y;
                        cell.onclick = (e) => handleCellClick(x, y, e);
                        if(data.displayNumber) {
                            const num = document.createElement('span');
                            num.className = 'cell-number';
                            num.innerText = data.displayNumber;
                            cell.appendChild(num);
                        }
                        const letSpan = document.createElement('span');
                        letSpan.className = 'cell-letter';
                        letSpan.id = `cell-char-${x}-${y}`;
                        letSpan.innerText = data.userChar;
                        cell.appendChild(letSpan);
                        if(data.correct) cell.classList.add('correct');
                    }
                    gridEl.appendChild(cell);
                }
            }
            wrapper.appendChild(gridEl);
        }

        function renderClueList() {
            const hList = document.getElementById('clues-horizontal-list');
            const vList = document.getElementById('clues-vertical-list');
            hList.innerHTML = '';
            vList.innerHTML = '';
            
            // Garantir que todas as palavras sejam listadas
            const hWords = state.wordsOnBoard.filter(w => w.dir === 'H').sort((a,b) => a.number - b.number);
            const vWords = state.wordsOnBoard.filter(w => w.dir === 'V').sort((a,b) => a.number - b.number);

            const createItem = (w) => {
                const div = document.createElement('div');
                div.className = 'clue-item';
                div.id = `clue-item-${state.wordsOnBoard.indexOf(w)}`;
                div.innerHTML = `<span class="clue-number">${w.number}-</span> ${w.clue}`;
                div.onclick = () => selectWordByIndex(state.wordsOnBoard.indexOf(w));
                return div;
            };
            
            if(hWords.length > 0) hWords.forEach(w => hList.appendChild(createItem(w)));
            else hList.innerHTML = '<div style="padding:5px; color:#999; font-size:0.8rem;">Nenhuma</div>';

            if(vWords.length > 0) vWords.forEach(w => vList.appendChild(createItem(w)));
            else vList.innerHTML = '<div style="padding:5px; color:#999; font-size:0.8rem;">Nenhuma</div>';
        }

        function focusInput() { if(state.selectedCell) state.inputElem.focus(); }

        function selectWordByIndex(idx) {
            state.selectedWordIndex = idx;
            const w = state.wordsOnBoard[idx];
            state.selectedCell = {x: w.x, y: w.y};
            refreshStyles();
            state.inputElem.focus();
        }

        function handleCellClick(x, y, e) {
            e.stopPropagation();
            const cellData = state.grid[y][x];
            if(state.selectedCell && state.selectedCell.x === x && state.selectedCell.y === y) {
                if(cellData.refs.length > 1) {
                    const currRefIdx = cellData.refs.indexOf(state.selectedWordIndex);
                    const nextRefIdx = (currRefIdx + 1) % cellData.refs.length;
                    state.selectedWordIndex = cellData.refs[nextRefIdx];
                }
            } else {
                state.selectedCell = {x, y};
                if(!cellData.refs.includes(state.selectedWordIndex)) {
                    state.selectedWordIndex = cellData.refs[0];
                }
            }
            refreshStyles();
            state.inputElem.focus();
        }

        function refreshStyles() {
            document.querySelectorAll('.cell.active').forEach(c => c.classList.remove('selected', 'highlighted-word'));
            document.querySelectorAll('.clue-item').forEach(c => c.classList.remove('active-clue'));

            if(state.selectedWordIndex !== -1) {
                const w = state.wordsOnBoard[state.selectedWordIndex];
                for(let i=0; i<w.word.length; i++) {
                    let cx = w.dir === 'H' ? w.x + i : w.x;
                    let cy = w.dir === 'H' ? w.y : w.y + i;
                    document.querySelector(`.cell[data-x='${cx}'][data-y='${cy}']`).classList.add('highlighted-word');
                }
                const listItem = document.getElementById(`clue-item-${state.selectedWordIndex}`);
                if(listItem) {
                    listItem.classList.add('active-clue');
                    listItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
                document.getElementById('footer-current-clue').innerText = `${w.number}: ${w.clue}`;
            }
            if(state.selectedCell) {
                document.querySelector(`.cell[data-x='${state.selectedCell.x}'][data-y='${state.selectedCell.y}']`).classList.add('selected');
            }
        }

        function setupInputListener() {
            const input = state.inputElem;
            input.addEventListener('input', (e) => {
                if(!state.selectedCell) return;
                const char = e.target.value.toUpperCase().slice(-1);
                input.value = '';
                if(/[A-Z]/.test(char)) insertLetter(char);
            });
            input.addEventListener('keydown', (e) => {
                if(e.key === 'Backspace') handleBackspace();
            });
        }

        function insertLetter(char) {
            const {x, y} = state.selectedCell;
            const data = state.grid[y][x];
            if(data.correct) { moveCursor(1); return; }
            data.userChar = char;
            document.getElementById(`cell-char-${x}-${y}`).innerText = char;
            checkWordCompletion(state.selectedWordIndex);
            moveCursor(1);
        }

        function handleBackspace() {
            if(!state.selectedCell) return;
            const {x, y} = state.selectedCell;
            const data = state.grid[y][x];
            if(!data.correct) {
                if(data.userChar === '') {
                    moveCursor(-1);
                    const prev = state.selectedCell;
                    const prevData = state.grid[prev.y][prev.x];
                    if(!prevData.correct) {
                        prevData.userChar = '';
                        document.getElementById(`cell-char-${prev.x}-${prev.y}`).innerText = '';
                    }
                } else {
                    data.userChar = '';
                    document.getElementById(`cell-char-${x}-${y}`).innerText = '';
                }
            } else { moveCursor(-1); }
        }

        function moveCursor(step) {
            const w = state.wordsOnBoard[state.selectedWordIndex];
            let idx = (w.dir === 'H') ? state.selectedCell.x - w.x : state.selectedCell.y - w.y;
            let nextIdx = idx + step;
            if(nextIdx >= 0 && nextIdx < w.word.length) {
                let nx = w.dir === 'H' ? w.x + nextIdx : w.x;
                let ny = w.dir === 'H' ? w.y : w.y + nextIdx;
                state.selectedCell = {x: nx, y: ny};
                refreshStyles();
            }
        }

        function checkWordCompletion(wIdx) {
            const w = state.wordsOnBoard[wIdx];
            if(w.solved) return;
            let typed = "", filled = true;
            for(let i=0; i<w.word.length; i++) {
                let cx = w.dir === 'H' ? w.x + i : w.x;
                let cy = w.dir === 'H' ? w.y : w.y + i;
                const cell = state.grid[cy][cx];
                if(!cell.userChar) filled = false;
                typed += cell.userChar;
            }
            if(filled) {
                if(typed === w.word) {
                    w.solved = true;
                    state.coins++;
                    updateUI();
                    for(let i=0; i<w.word.length; i++) {
                        let cx = w.dir === 'H' ? w.x + i : w.x;
                        let cy = w.dir === 'H' ? w.y : w.y + i;
                        state.grid[cy][cx].correct = true;
                        document.querySelector(`.cell[data-x='${cx}'][data-y='${cy}']`).classList.add('correct');
                    }
                    document.getElementById(`clue-item-${wIdx}`).classList.add('solved-clue');
                    showFeedback('success');
                    if(state.wordsOnBoard.every(wd => wd.solved)) {
                        state.coins += 100;
                        updateUI();
                        setTimeout(() => document.getElementById('modal-victory').classList.remove('hidden'), 1000);
                    }
                } else {
                    showFeedback('error');
                    setTimeout(() => {
                        for(let i=0; i<w.word.length; i++) {
                            let cx = w.dir === 'H' ? w.x + i : w.x;
                            let cy = w.dir === 'H' ? w.y : w.y + i;
                            const cellData = state.grid[cy][cx];
                            if(!cellData.correct) {
                                document.querySelector(`.cell[data-x='${cx}'][data-y='${cy}']`).classList.add('wrong');
                                setTimeout(() => document.querySelector(`.cell[data-x='${cx}'][data-y='${cy}']`).classList.remove('wrong'), 500);
                                cellData.userChar = '';
                                document.getElementById(`cell-char-${cx}-${cy}`).innerText = '';
                            }
                        }
                        state.selectedCell = {x: w.x, y: w.y};
                        refreshStyles();
                    }, 400);
                }
            }
        }

        function showFeedback(type) {
            const el = document.getElementById('feedback-message');
            el.classList.remove('hidden');
            el.innerHTML = type === 'success' 
                ? `<div class="bg-white border-4 border-green-500 p-6 rounded-2xl shadow-2xl flex flex-col items-center justify-center animate-bounce"><i class="fas fa-check-circle text-green-500 text-5xl"></i><h3 class="font-bold text-green-800 text-2xl mt-2">CORRETO!</h3></div>`
                : `<div class="bg-white border-4 border-red-500 p-6 rounded-2xl shadow-2xl flex flex-col items-center justify-center animate-pulse"><i class="fas fa-times-circle text-red-500 text-5xl"></i><h3 class="font-bold text-red-800 text-2xl mt-2">TENTE DE NOVO</h3></div>`;
            setTimeout(() => el.classList.add('hidden'), 1500);
        }

        function useHint() {
            if(!state.selectedCell) { alert("Selecione um quadrado primeiro!"); return; }
            if(state.coins < 2) { alert("Você precisa de 2 moedas!"); return; }
            const {x, y} = state.selectedCell;
            const cellData = state.grid[y][x];
            if(cellData.correct) { moveCursor(1); return; }
            state.coins -= 2;
            updateUI();
            const correctChar = cellData.char;
            cellData.userChar = correctChar;
            document.getElementById(`cell-char-${x}-${y}`).innerText = correctChar;
            checkWordCompletion(state.selectedWordIndex);
            if(!state.wordsOnBoard[state.selectedWordIndex].solved) moveCursor(1);
        }

        function resetGame() {
            if(document.getElementById('modal-victory').classList.contains('hidden') && !confirm("Reiniciar o jogo?")) return;
            document.getElementById('modal-victory').classList.add('hidden');
            state.grid.flat().forEach(c => { if(c.type === 'letter') { c.userChar = ''; c.correct = false; } });
            state.wordsOnBoard.forEach(w => w.solved = false);
            renderGrid();
            renderClueList();
            state.selectedCell = null;
            state.selectedWordIndex = -1;
            refreshStyles();
        }
    </script>
</body>
</html>
